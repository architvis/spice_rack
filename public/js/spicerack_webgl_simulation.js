(()=>{"use strict";class t{constructor(t,i,e="entity",s=!0){this.visable=!0,this.active=s,this.type=e,this.x=t,this.y=i,this.xrel=0,this.yrel=0}tick(t){}}class i extends t{constructor(t,i,e="none",s,a){super(t,i,"display"),this.state=e,this.displayString=s,this.displayValue=a,this.times=[0,0,0,0,0,0,0,0,0,0,0,0]}tick(t){this.times.push(t),this.times.shift();let i=0;this.times.forEach((t=>{i+=t})),this.displayValue=Math.floor(i/this.times.length)}}class e extends t{constructor(t,i,e="none",s){super(t,i,"spiceholder"),this.state=e,this.displayString=s}}class s extends t{constructor(t,i,s,a,c=7,l){var h;super(t,i,"spicerack"),this.spices=[],this.scale=s,this.position=[t,i],this.degree=a,this.targetDegree=0,this.state="idle",this.degStep=1,this.direction=0;let n=Math.sin,r=Math.cos;for(let t=0;t<c;t++){let i=t*(360/c)*Math.PI/180,s=0*r(i)+1*-n(i),a=0*n(i)+1*r(i);h=new e(s,a,"none"),this.spices.push(h),l.addEntity(h)}}updateChildren(){this.spices.forEach((t=>{t.xrel=0,t.yrel=0;let i=this.degree*Math.PI/180,e=Math.sin,s=Math.cos;t.xrel=t.x*s(i)+e(i)*t.y,t.yrel=t.x*-e(i)+s(i)*t.y,t.xrel=t.xrel*this.scale,t.yrel=t.yrel*this.scale,t.xrel=t.xrel+this.position[0],t.yrel=t.yrel+this.position[1]}))}runMoveTo(t){this.targetDegree!=this.degree?1==this.direction?this.degree+=this.degStep:-1==this.direction&&(this.degree-=this.degStep):this.state="idle"}tick(){this.updateChildren()}}class a{constructor(t="canvas",i,e){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.entities=[]}addEntity(t){this.entities.push(t)}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawEntities(){for(var t,i=0;i<this.entities.length;i++)switch((t=this.entities[i]).type){case"entity":case"inactive":break;case"spicerack":this.drawSpiceRack(t.x+t.xrel,t.y+t.yrel);break;case"display":this.drawDisplay(t.x,t.y,t.displayString,t.displayValue);break;case"spiceholder":"none"==t.state?this.drawSpiceHolder(t.x+t.xrel,t.y+t.yrel):"full"==t.state?this.drawSpice(t.x+t.xrel,t.y+t.yrel,t.displayString):"half"==t.state&&this.drawSpice(t.x+t.xrel,t.y+t.yrel)}}tick(t){for(var i=0;i<this.entities.length;i++)this.entities[i].tick(t)}drawSpiceHolder(t,i){this.ctx.beginPath(),this.ctx.arc(t,i,40,0,2*Math.PI),this.ctx.stroke()}drawSpice(t,i,e=""){this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t,i,40,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="20px Arial",this.ctx.fillText(e,t-this.ctx.measureText(e).width/2,i+this.ctx.measureText("A").width/2),this.ctx.restore()}drawSpiceRack(t,i){this.ctx.beginPath(),this.ctx.arc(t,i,20,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t,i,150,0,2*Math.PI),this.ctx.stroke();let e=[0,150];this.ctx.beginPath(),this.ctx.moveTo(t,i+e[1]+15),this.ctx.lineTo(t+15,i+e[1]+15),this.ctx.lineTo(t,i+e[1]-15),this.ctx.lineTo(t-15,i+e[1]+15),this.ctx.fill()}drawDisplay(t,i,e,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t,i,200,50),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="20px Arial";let a=e+": "+s;this.ctx.fillText(a,t+100-this.ctx.measureText(a).width/2,i+25+this.ctx.measureText("A").width/2),this.ctx.restore()}}function c(t){let i={lastTime:window.performance.now(),spiceRack1,spiceRack2};!function e(){let s=window.performance.now(),a=Math.floor(1e3/(s-i.lastTime));i.lastTime=s,t.tick(a),t.clearCanvas(),t.drawEntities(),window.requestAnimationFrame(e)}()}window.socket=io(),window.socket.on("connection",(t=>{console.log("a user connected"),t.on("disconnect",(()=>{console.log("user disconnected")}))})),window.spiceRack1,window.spiceRack2,window.model,document.addEventListener("DOMContentLoaded",(function(){!function(){let t=new a("web_gl_simulation",200,200),e=new s(200,200,100,0,7,t);window.spiceRack1=e,t.addEntity(e);let l=new s(700,200,100,0,7,t);window.spiceRack2=l,t.addEntity(l);let h=new i(790,0,"inactive","Display","Val");window.display1=h,t.addEntity(h),h.displayString="Display",h.displayValue="val",e.spices[0].state="full",e.spices[0].displayString="0",e.spices[1].state="full",e.spices[1].displayString="1",e.spices[6].state="full",e.spices[6].displayString="6",l.spices[5].state="full",l.spices[5].displayString="Salt",l.spices[3].state="full",l.spices[3].displayString="Pepper",l.spices[0].state="full",l.spices[0].displayString="Garlic",c(t)}()}))})();