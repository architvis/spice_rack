(()=>{"use strict";class t{constructor(t,e,i="entity",s=!0){this.visable=!0,this.active=s,this.type=i,this.x=t,this.y=e,this.xrel=0,this.yrel=0}tick(t){}}class e extends t{constructor(t,e,i="none",s,a){super(t,e,"display"),this.state=i,this.displayString=s,this.displayValue=a,this.times=[0,0,0,0,0,0,0,0,0,0,0,0]}tick(t){this.times.push(t),this.times.shift();let e=0;this.times.forEach((t=>{e+=t})),this.displayValue=Math.floor(e/this.times.length)}}class i extends t{constructor(t,e,i="none",s,a=100){super(t,e,"spiceholder"),this.state=i,this.displayString=s,this.radiusDistance=a}}class s extends t{constructor(t,e,s,a=0,c=[]){var n;super(t,e,"spicerack"),this.spices=[],this.radiusDistance=s,this.position=[t,e],this.degree=a,this.targetDegree=0,this.state="idle",this.degStep=1,this.direction=0;let l=Math.sin,r=Math.cos;for(let t=0;t<c.length;t++){let e=c[t].rotation,s=0*r(e)+1*l(e),a=0*-l(e)+1*r(e);n=new i(s,a,"none"),this.spices.push(n),console.log("spice added")}}replaceChildren(t=[]){this.clearSpices(),this.addChildren(t)}addChildren(t=[]){var e;let s=Math.sin,a=Math.cos;for(let n=0;n<t.length;n++){let l=t[n].rotation*Math.PI/180,r=1*s(l),o=1*a(l);var c="";switch(t[n].contents){case-1:c="none";break;case 1:c="quarter";break;case 2:c="half";break;case 3:c="3 quarters";break;case 4:c="full";break;default:c="none"}e=new i(r,o,c,t[n].name,t[n].radiusDistance),this.spices.push(e),console.log("spice added")}}updateChildren(){this.spices.forEach((t=>{t.xrel=0,t.yrel=0;let e=this.degree*Math.PI/180,i=Math.sin,s=Math.cos;t.xrel=t.x*s(e)+-i(e)*t.y,t.yrel=t.x*i(e)+s(e)*t.y,t.xrel=t.xrel*t.radiusDistance,t.yrel=t.yrel*t.radiusDistance,t.xrel=t.xrel+this.position[0],t.yrel=t.yrel+this.position[1]}))}runMoveTo(t){this.targetDegree!=this.degree?1==this.direction?this.degree+=this.degStep:-1==this.direction&&(this.degree-=this.degStep):this.state="idle"}clearSpices(){this.spices=[]}tick(){this.updateChildren()}}class a{constructor(t="canvas",e,i){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.entities=[]}addEntity(t){this.entities.push(t)}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawEntities(){for(var t=0;t<this.entities.length;t++)this.drawEntity(this.entities[t])}drawEntity(t){switch(t.type){case"entity":case"inactive":break;case"spicerack":this.drawSpiceRack(t.x+t.xrel,t.y+t.yrel),t.spices.forEach((t=>{this.drawEntity(t)}));break;case"display":this.drawDisplay(t.x,t.y,t.displayString,t.displayValue);break;case"spiceholder":var e=[];switch(t.state){case"none":e=["#DDDDDD","black"];break;case"quarter":e=["#FFDC00","white"];break;case"half":e=["#7FDBFF","white"];break;case"3 quarters":e=["#0074D9","white"];break;case"full":e=["#001f3f","white"];break;default:e=["black","white"]}this.drawSpice(t.x+t.xrel,t.y+t.yrel,t.displayString,e[0],e[1])}}tick(t){for(var e=0;e<this.entities.length;e++)this.entities[e].tick(t)}drawSpiceHolder(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,40,0,2*Math.PI),this.ctx.stroke()}drawSpice(t,e,i="",s="black",a="white"){this.ctx.save(),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t,e,40,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=a,this.ctx.font="20px Arial",this.ctx.fillText(i,t-this.ctx.measureText(i).width/2,e+this.ctx.measureText("A").width/2),this.ctx.restore()}drawSpiceRack(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,20,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t,e,150,0,2*Math.PI),this.ctx.stroke();let i=[0,150];this.ctx.beginPath(),this.ctx.moveTo(t,e+i[1]+15),this.ctx.lineTo(t+15,e+i[1]+15),this.ctx.lineTo(t,e+i[1]-15),this.ctx.lineTo(t-15,e+i[1]+15),this.ctx.fill()}drawDisplay(t,e,i,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t,e,200,50),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="20px Arial";let a=i+": "+s;this.ctx.fillText(a,t+100-this.ctx.measureText(a).width/2,e+25+this.ctx.measureText("A").width/2),this.ctx.restore()}}function c(){let t=new a("web_gl_simulation",200,200),i=new s(200,200,100,0,inventory);var c;window.spiceRack1=i,t.addEntity(window.spiceRack1),c=i,window.socket.on("connection",(t=>{console.log("a user connected"),t.on("disconnect",(()=>{console.log("user disconnected")}))})),window.socket.on("turnTable_rotation",(t=>{console.log("Turn Table rotation: "+t),c.degree=t})),window.socket.on("turnTable_inventory",(t=>{var e;console.log("Turn Table inventory message received"),window.inventory=t,c.replaceChildren(t),(e=$("#moveto_ui")).empty(),window.inventory.forEach((t=>{var i=$('<div class="row" style=" margin:20px 0px;"></div>'),s=$(' <button class="btn-primary btn btn-block col-lg-2 col-xl-2 col-6">Select</button>');i.append(s);var a=$(' <label class=" col-form-label col-form-label-md col-lg-2 col-xl-2 col-6" style="margin:auto;  text-align: center;">'+t.name+"</label>");i.append(a);var c=$(' <div class="col-lg-4 col-xl-4 col-6" style="margin:auto;"></div>'),n=$('<input type="text" placeholder="New Spice" class=".form-control" style=" width:100%; height:100%;"></input>');c.append(n),i.append(c);var l=parseInt(t.contents),r=$('<div class="col-lg-4 col-xl-4 col-6" style="margin:10px 0px; height:30px;"></div>'),o=$(' <div class="progress " style="height:100%; padding:0px;"> <div class="progress-bar progress-bar-striped" style="width: '+(-1!=l?25*l:0)+'%; " ></div></div>');r.append(o),i.append(r),e.append(i),s.on("click",(()=>{var e;e=t.uid,$.get("/movetopoint/"+e,(function(t,e,i){console.log("status: "+e+", data:"+t)}))})),n.on("keypress",(function(e){13===e.which&&console.log("Change "+t.uid+" spice name => "+n.val())}))}))}));let l=new s(700,200,100,0);window.spiceRack2=l,t.addEntity(l);let r=new e(790,0,"inactive","Display","Val");window.display1=r,t.addEntity(r),n(t)}function n(t){let e={lastTime:window.performance.now(),spiceRack1,spiceRack2};!function i(){let s=window.performance.now(),a=Math.floor(1e3/(s-e.lastTime));e.lastTime=s,t.tick(a),t.clearCanvas(),t.drawEntities(),window.requestAnimationFrame(i)}()}window.socket=io(),window.inventory=[],window.spiceRack1,window.spiceRack2,window.model,document.addEventListener("DOMContentLoaded",(function(){c()}))})();