(()=>{"use strict";class t{constructor(t,e,i="entity",s=!0){this.visable=!0,this.active=s,this.type=i,this.x=t,this.y=e,this.xrel=0,this.yrel=0}tick(t){}}class e extends t{constructor(t,e,i="none",s,n=100,a=0){super(t,e,"spiceholder"),this.state=i,this.displayString=s,this.radiusDistance=n,this.contents=a}}class i extends t{constructor(t,e,i,s=0,n=[]){super(t,e,"spicerack"),this.spices=[],this.platformRadius=i,this.position=[t,e],this.degree=s,this.targetDegree=0,this.state="idle",this.degStep=1,this.direction=0,this.addChildren(n)}replaceChildren(t=[]){this.clearSpices(),this.addChildren(t)}addChildren(t=[]){var i;let s=Math.sin,n=Math.cos;for(let a=0;a<t.length;a++){let l=t[a].rotation*Math.PI/180,o=1*s(l),c=1*n(l);i=new e(o,c,t[a].state,t[a].name,t[a].radiusDistance,t[a].contents),this.spices.push(i)}}updateChildren(){this.spices.forEach((t=>{t.xrel=0,t.yrel=0;let e=this.degree*Math.PI/180,i=Math.sin,s=Math.cos;t.xrel=t.x*s(e)+-i(e)*t.y,t.yrel=t.x*i(e)+s(e)*t.y,t.xrel=t.xrel*t.radiusDistance,t.yrel=t.yrel*t.radiusDistance,t.xrel=t.xrel+this.position[0],t.yrel=t.yrel+this.position[1]}))}runMoveTo(t){this.targetDegree!=this.degree?1==this.direction?this.degree+=this.degStep:-1==this.direction&&(this.degree-=this.degStep):this.state="idle"}clearSpices(){this.spices=[]}tick(){this.updateChildren()}}class s{constructor(t="canvas",e,i){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.entities=[]}addEntity(t){this.entities.push(t)}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawEntities(){for(var t=0;t<this.entities.length;t++)this.drawEntity(this.entities[t])}drawEntity(t){switch(t.type){case"entity":case"inactive":break;case"spicerack":this.drawSpiceRack(t),t.spices.forEach((t=>{this.drawEntity(t)}));break;case"display":this.drawDisplay(t.x,t.y,t.displayString,t.displayValue);break;case"spiceholder":var e=[];switch(t.contents){case"0":e=["#DDDDDD","black"];break;case"1":e=["#FFDC00","white"];break;case"2":e=["#7FDBFF","white"];break;case"3":e=["#0074D9","white"];break;case"4":e=["#001f3f","white"];break;default:e=["black","white"]}this.drawSpice(t.x+t.xrel,t.y+t.yrel,t.displayString,e[0],e[1])}}tick(){for(var t=0;t<this.entities.length;t++)this.entities[t].tick()}drawSpiceHolder(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,40,0,2*Math.PI),this.ctx.stroke()}drawSpice(t,e,i="",s="black",n="white"){this.ctx.save(),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t,e,40,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=n,this.ctx.font="20px Arial",this.ctx.fillText(i,t-this.ctx.measureText(i).width/2,e+this.ctx.measureText("A").width/2),this.ctx.restore()}drawSpiceRack(t){var e=t.x+t.xrel,i=t.y+t.yrel;this.ctx.beginPath(),this.ctx.arc(e,i,20,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(e,i,t.platformRadius,0,2*Math.PI),this.ctx.stroke();let s=[0,150];this.ctx.beginPath(),this.ctx.moveTo(e,i+s[1]+15),this.ctx.lineTo(e+15,i+s[1]+15),this.ctx.lineTo(e,i+s[1]-15),this.ctx.lineTo(e-15,i+s[1]+15),this.ctx.fill()}drawDisplay(t,e,i,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t,e,200,50),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="20px Arial";let n=i+": "+s;this.ctx.fillText(n,t+100-this.ctx.measureText(n).width/2,e+25+this.ctx.measureText("A").width/2),this.ctx.restore()}}function n(){let t=new s("web_gl_simulation",200,200),e=new i(250,250,150,0,inventory);var n;t.addEntity(e),n=e,window.socket.on("turnTable_rotation",(t=>{n.degree=t})),window.socket.on("turnTable_inventory",(t=>{window.inventory=t,n.replaceChildren(t),function(){var t=$("#moveto_ui");t.empty(),window.inventory.forEach((e=>{var i=$('<div class="row" style=" margin:20px 0px;"></div>'),s=$(' <button class="btn-primary btn btn-block col-lg-2 col-xl-2 col-12">Select</button>');i.append(s);var n=$(' <div class="col-lg-2 col-xl-2 col-6" style="margin:auto;"></div>'),a=$('<input type="text" placeholder="New Spice" class=".form-control" style=" width:100%; height:100%;"></input>');n.append(a),i.append(n);var l=$(' <label class=" col-form-label col-form-label-md col-lg-2 col-xl-2 col-6" style="margin:auto;  text-align: center;">'+e.name+"</label>");i.append(l);var o=$('<div class="col-lg-2 col-xl-2 col-6"></div>'),c=$('<select class="custom-select mr-sm-2" >\n    <option selected value="null">Choose...</option>\n    <option value="-1">No spice</option>\n    <option value="0">Empty</option>\n    <option value="1">1/4 Full</option>\n    <option value="2">1/2 Full</option>\n    <option value="3">3/4 Full</option>\n    <option value="4">Full</option></select>');c.val(e.contents),o.append(c),i.append(o);var r=parseInt(e.contents),h=$('<div class="col-lg-4 col-xl-4 col-6" style="margin:10px 0px; height:30px;"></div>'),p=$(' <div class="progress " style="height:100%; padding:0px;"> <div class="progress-bar progress-bar-striped" style="width: '+(-1!=r?25*r:0)+'%; " ></div></div>');h.append(p),i.append(h),t.append(i),s.on("click",(()=>{var t;t=e.uid,$.get("/movetopoint/"+t,(function(t,e,i){}))})),a.on("keypress",(function(t){var i,s;13===t.which&&(i=e.uid,s=a.val(),$.post("setName",{name:s,id:i},(function(t){}),"json"))})),c.on("change",(()=>{"null"!=c.val()&&function(t,e){$.post("setContents",{contents:e,id:t},(function(t){}),"json")}(e.uid,c.val())}))}));let e=$('<div class="row" style=" margin:20px 0px;"></div>'),i=$('<button class="btn-primary btn btn-block col-lg-2 col-xl-2 col-12"><</button>');e.append(i);var s=$('<div class="col-lg-2 col-xl-2 col-6"></div>'),n=$('<select class="custom-select mr-sm-2" >\n  <option selected value="null">Choose...</option>\n  <option value="1">1 step</option>\n  <option value="5">5 step</option>\n  <option value="10">10 step</option>\n  <option value="100">100 step</option>\n  <option value="1000">1000 step</option>');n.val(10),s.append(n),e.append(s),t.append(e)}()})),function(t){!function e(){t.tick(),t.clearCanvas(),t.drawEntities(),window.requestAnimationFrame(e)}()}(t)}window.socket=io(),window.inventory=[],document.addEventListener("DOMContentLoaded",(function(){n()}))})();